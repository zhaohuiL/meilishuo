<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
	  <meta http-equiv="X-UA-Compatible" content="ie=edge">
		<link rel="stylesheet" href="css/index.css">
		<title></title>
	</head>
	<body>
		<div class="header">
			<div class="">
				<a href="index.html" class="logo"></a>
				<a href="search.html"><input class="search" type="text" placeholder="套装"></a>
				<a href="#" class="message"></a>
				<a href="index.html" class="cansel">取消</a>
			</div>
		</div>
		<div id="body-box">
			<div class="carousel" id="carousel">
				<div class="imageList">
					<ul>
						<li><a href="#"><img src="img/banner1.jpg" alt=""></a></li>
						<li><a href="#"><img src="img/banner2.jpg" alt=""></a></li>
						<li><a href="#"><img src="img/banner1.jpg" alt=""></a></li>
						<li><a href="#"><img src="img/banner2.jpg" alt=""></a></li>
						<li><a href="#"><img src="img/banner1.jpg" alt=""></a></li>
					</ul>
				</div>
				<ul class="circle">
					<li></li>
					<li></li>
					<li></li>
					<li></li>
					<li style="margin-right:0;"></li>
				</ul>
			</div>
			<div class="recommend">
				<ul>
					<li>
						<a href=""><img src="img/recommend1.gif" alt=""></a>
						<p>1分抽奖</p>
					</li>
					<li>
						<a href=""><img src="https://s11.mogucdn.com/mlcdn/c45406/170913_04i7dae31fg3bkc1j6dej7b3j506d_225x225.png_160x160.v1cAC.70.webp" alt=""></a>
						<p>9.9封顶</p>
					</li>
					<li>
						<a href=""><img src="https://s11.mogucdn.com/mlcdn/c45406/170913_8e5d00adb9il82hikh25g8ed9j01c_225x225.png_160x160.v1cAC.70.webp" alt=""></a>
						<p>时尚拼团</p>
					</li>
					<li style="margin-right:0;">
						<a href=""><img src="https://s3.mogucdn.com/mlcdn/c45406/170921_19ee6j3a6e42l44k1d25c72djbi15_225x225.jpg_160x160.v1cAC.70.webp" alt=""></a>
						<p>大家都在买</p>
					</li>
				</ul>
			</div>
			<div class="team-sale">
				<div class="team-sale-title">
					<span>超值拼团</span>
					<a href="#">全部拼团></a>
				</div>
				<div class="team-sale-body">
					<ul>
						<li>
							<a href="#">
								<div class="team-sale-img">
									<img src="http://s3.mogucdn.com/mlcdn/917393/171006_31jefdc0ie93i51kljdk1h15122d6_640x900.jpg_640x999.jpg_400x400.v1cOK.81.webp" alt="">
									<i></i>
								</div>
								<div class="team-sale-price">
									<h3>美丽说 秋季感恩套装（小甘菊护手霜+近江兄弟唇膏）</h3>
									<div class="team-sale-bottom">
										<div class="team-sale-left">
											<span>￥0.01</span>
											<p>4人团·已团4071件</p>
										</div>
										<div class="gobutton">
											去开团
										</div>
									</div>
								</div>
							</a>
						</li>
						<li>
							<a href="#">
								<div class="team-sale-img">
									<img src="http://s3.mogucdn.com/p2/170815/upload_1c2hjba6k05g36kh4dg1hig1a85bd_640x900.jpg_640x999.jpg_400x400.v1cOK.81.webp" alt="">
									<i></i>
								</div>
								<div  class="team-sale-price">
									<h3>御泥坊黑面膜补水保湿7片清洁控油收缩毛孔去黑头</h3>
									<div class="team-sale-bottom">
										<div class="team-sale-left">
											<span>￥0.01</span>
											<p>4人团·已团29702件</p>
										</div>
										<div class="gobutton">
											去开团
										</div>
									</div>
								</div>
							</a>
						</li>
						<li>
							<a href="#">
								<div class="team-sale-img">
									<img src="http://s3.mogucdn.com/mlcdn/917393/170915_2alde541b0dlbk483a38hdhb088i0_1600x2250.jpg_640x999.jpg_400x400.v1cOK.81.webp" alt="">
									<i></i>
								</div>
								<div  class="team-sale-price">
									<h3>MIUMIU缪缪女士香氛</h3>
									<div class="team-sale-bottom">
										<div class="team-sale-left">
											<span>￥0.01</span>
											<p>4人团·已团4092件</p>
										</div>
										<div class="gobutton">
											去开团
										</div>
									</div>
								</div>
							</a>
						</li>
					</ul>
				</div>
				<div class="team-sale-bottom-btn">
					<a href="#">全部超值拼团</a>
				</div>
			</div>
			<div class="time-limit">
				<div class="time-limit-title">
					<div class="time-limit-word">
						<hr>
						<div>限时特惠距活动结束仅剩</div>
					</div>
					<div class="time-limit-time">
						<span class="detail-wrap"></span>
						<span class="detail-wrap"></span>
						<span class="label-wrap">天</span>
						<span class="detail-wrap"></span>
						<span class="detail-wrap"></span>
						<span class="label-wrap">时</span>
						<span class="detail-wrap"></span>
						<span class="detail-wrap"></span>
						<span class="label-wrap">分</span>
						<span class="detail-wrap"></span>
						<span class="detail-wrap"></span>
						<span class="label-wrap">秒</span>
						<span class="detail-wrap"></span>
						<span class="detail-wrap"></span>
					</div>
				</div>
				<div class="time-limit-body">
						<ul>
							<li>
								<a href="#">
									<img src="http://s3.mogucdn.com/p2/170901/upload_17a6lfh4779jg6kbh76e9d69024d8_640x900.jpg_640x999.webp" alt="">
									<div class="time-limit-price">
										<span>￥39.60</span>
										<s>45.00</s>
									</div>
									<div class="time-limit-btn">立即抢购</div>
								</a>
							</li>
							<li>
								<a href="#">
									<img src="http://s3.mogucdn.com/p2/170901/upload_17a6lfh4779jg6kbh76e9d69024d8_640x900.jpg_640x999.webp" alt="">
									<div class="time-limit-price">
										<span>￥39.60</span>
										<s>45.00</s>
									</div>
									<div class="time-limit-btn">立即抢购</div>
								</a>
							</li>
							<li>
								<a href="#">
									<img src="http://s3.mogucdn.com/p2/170901/upload_17a6lfh4779jg6kbh76e9d69024d8_640x900.jpg_640x999.webp" alt="">
									<div class="time-limit-price">
										<span>￥39.60</span>
										<s>45.00</s>
									</div>
									<div class="time-limit-btn">立即抢购</div>
								</a>
							</li>
							<li>
								<a href="#">
									<img src="http://s3.mogucdn.com/p2/170901/upload_17a6lfh4779jg6kbh76e9d69024d8_640x900.jpg_640x999.webp" alt="">
									<div class="time-limit-price">
										<span>￥39.60</span>
										<s>45.00</s>
									</div>
									<div class="time-limit-btn">立即抢购</div>
								</a>
							</li>
							<li>
								<a href="#">
									<img src="http://s3.mogucdn.com/p2/170901/upload_17a6lfh4779jg6kbh76e9d69024d8_640x900.jpg_640x999.webp" alt="">
									<div class="time-limit-price">
										<span>￥39.60</span>
										<s>45.00</s>
									</div>
									<div class="time-limit-btn">立即抢购</div>
								</a>
							</li>
							<li>
								<a href="#">
									<img src="http://s3.mogucdn.com/p2/170901/upload_17a6lfh4779jg6kbh76e9d69024d8_640x900.jpg_640x999.webp" alt="">
									<div class="time-limit-price">
										<span>￥39.60</span>
										<s>45.00</s>
									</div>
									<div class="time-limit-btn">立即抢购</div>
								</a>
							</li>
							<li>
								<a href="#">
									<img src="http://s3.mogucdn.com/p2/170901/upload_17a6lfh4779jg6kbh76e9d69024d8_640x900.jpg_640x999.webp" alt="">
									<div class="time-limit-price">
										<span>￥39.60</span>
										<s>45.00</s>
									</div>
									<div class="time-limit-btn">立即抢购</div>
								</a>
							</li>
							<li>
								<a href="#">
									<img src="http://s3.mogucdn.com/p2/170901/upload_17a6lfh4779jg6kbh76e9d69024d8_640x900.jpg_640x999.webp" alt="">
									<div class="time-limit-price">
										<span>￥39.60</span>
										<s>45.00</s>
									</div>
									<div class="time-limit-btn">立即抢购</div>
								</a>
							</li>
							<li>
								<a href="#">
									<img src="http://s3.mogucdn.com/p2/170901/upload_17a6lfh4779jg6kbh76e9d69024d8_640x900.jpg_640x999.webp" alt="">
									<div class="time-limit-price">
										<span>￥39.60</span>
										<s>45.00</s>
									</div>
									<div class="time-limit-btn">立即抢购</div>
								</a>
							</li>
							<li>
								<a href="#">
									<img src="http://s3.mogucdn.com/p2/170901/upload_17a6lfh4779jg6kbh76e9d69024d8_640x900.jpg_640x999.webp" alt="">
									<div class="time-limit-price">
										<span>￥39.60</span>
										<s>45.00</s>
									</div>
									<div class="time-limit-btn">立即抢购</div>
								</a>
							</li>
							<li>
								<a href="#" class="time-limit-more"></a>
							</li>
						</ul>
					</div>
			</div>
			<div class="this-week">
				<ul>
					<li><a href="#"></a></li>
					<li><a href="#"></a></li>
					<li><a href="#"></a></li>
					<li><a href="#"></a></li>
					<li><a href="#"></a></li>
					<li><a href="#"></a></li>
					<li><a href="#"></a></li>
					<li><a href="#"></a></li>
				</ul>
				<div class="this-week-img"><img src="https://s10.mogucdn.com/mlcdn/c45406/170926_2kh729k6jbeg2e9ej666jle9ihc0f_740x543.jpg_800x9999.v1c7E.70.webp" alt=""></div>
			</div>
			<div class="day-more">
					<img src="https://s10.mogucdn.com/mlcdn/c45406/170523_3588j3005fhc2d8f1icgijbgg23gk_740x128.jpg_800x9999.v1c7E.70.webp" alt="">
					<a href="#">查看更多    ></a>
			</div>
			<div class="goods">
				<div class="cat-box">
					<ul id="cat-top">
						<li><div class="goods-now">热门</div></li>
					</ul>
				</div>
				<template class="cat-template">
					<li> <div>${cat_name}</div></li>
				</template>
				<ul class="hot-goods">

				</ul>
				<ul class="goods-apart0" style="display:none;">

				</ul>
				<ul class="goods-apart1" style="display:none;">

				</ul>
				<template class="hot-goods-template">
					<li>
						<a href="goods.html?goods_id=${goods_id}">
							<div class="goods-img">
								<img src="${goods_thumb}" alt="">
								<i></i>
							</div>
							<div class="goods-name">
								${goods_name}
							</div>
							<div class="goods-price">
								￥${price}
							</div>
						</a>
					</li>
				</template>
			</div>
		</div>
		<nav>
			<ul>
				<li>
					<a href="index.html">
						<i></i>
						<span>首页</span>
					</a>
				</li>
				<li>
					<a href="list.html">
						<i></i>
						<span>分类</span>
					</a>
				</li>
				<li>
					<a href="cart.html">
						<i></i>
						<span>购物车</span>
					</a>
				</li>
				<li>
					<a href="me.html">
						<i></i>
						<span>我</span>
					</a>
				</li>
			</ul>
		</nav>
		<div class="back-top" id="back-top">
			<span>TOP</span>
		</div>
		<script src="js/jquery-3.2.1.js" charset="utf-8"></script>
		<!--改变根元素的font-size-->
		<script type="text/javascript">
			var windowWidth;
			var carousel = document.querySelector("#carousel");
			var imageLi = document.querySelectorAll(".imageList li");
			var $circleLi = $(".circle li");
			var idx = 0;
			var next = 1;
			var prev = imageLi.length-1;
			set();
			window.onresize = set;

			function set(){
				windowWidth = document.documentElement.clientWidth;
				console.log(windowWidth);
				var fontsize = windowWidth / 3.75;
				document.documentElement.style.fontSize = fontsize + "px";
				// console.log(windowWidth);
				imageLi.forEach(function(item){
					item.style.transform = "translateX("+ windowWidth +"px)"
				});
				$circleLi.eq(idx).css("background-color","#d43e2e");
				imageLi[idx].style.transition = "none";
	      imageLi[prev].style.transition = "none";
	      imageLi[next].style.transition = "none";

	      imageLi[idx].style.transform = "translateX(0px)";
	      imageLi[prev].style.transform = "translateX(" + -windowWidth + "px)";
	      imageLi[next].style.transform = "translateX(" + windowWidth + "px)";
				return windowWidth;
			}
			carousel.addEventListener("touchstart",touchstartHandler,false);
			carousel.addEventListener("touchmove",touchmoveHandler,false);
			carousel.addEventListener("touchend",touchendHandler,false);

			var deltaX;//手指x方向上的偏移量
			var startX;//触摸开始时候的手指的位置
			var startTime;//时间戳
			var timer = setInterval(function(){
				showNext();
			},3000);
			// init();
			// function init(){
			//
			// }

			function touchstartHandler(event){
				event.preventDefault();
				if(event.touches.length > 1) return;
				clearInterval(timer);
				//记录偏移量
				deltaX = event.touches[0].clientX;
				startX = event.touches[0].clientX;
				startTime = new Date();
				imageLi[idx].style.transition = "none";
				imageLi[prev].style.transition = "none";
				imageLi[next].style.transition = "none";
			}
			function touchmoveHandler(event){
				event.preventDefault();
				if(event.touches.length > 1) return;
				var clientX = event.touches[0].clientX;
				imageLi[idx].style.transform = "translateX("+(clientX-deltaX)+"px)";
				imageLi[prev].style.transform = "translateX("+(-windowWidth+clientX-deltaX)+"px)";
				imageLi[next].style.transform = "translateX("+(windowWidth+clientX-deltaX)+"px)";
			}
			function touchendHandler(event){
				event.preventDefault();
				var distance = event.changedTouches[0].clientX - startX;
				var time = new Date() - startTime;
				if(distance >= (windowWidth / 2) || (distance > 30 && time<300)){
					//向右滑动成功
					next = idx;
					idx = prev;
					prev--;
					if(prev < 0){
						prev = imageLi.length - 1;
					}
					imageLi[next].style.transition = "all 0.3s ease 0s";
					imageLi[idx].style.transition= "all 0.3s ease 0s";

					imageLi[next].style.transform = "translateX("+windowWidth+"px)";
					imageLi[idx].style.transform = "translateX(0px)";
					$circleLi.each(function(i){
						$(this).css("background-color","#fff")
					});
					$circleLi.eq(idx).css("background-color","#d43e2e");
				}else if(distance < (-windowWidth / 2) || (distance < -30 && time < 300)){
					showNext();
				}else{
					imageLi[prev].style.transition = "all 0.3s ease 0s";
					imageLi[idx].style.transition = "all 0.3s ease 0s";
					imageLi[next].style.transition = "all 0.3s ease 0s";
					imageLi[prev].style.transform = "translateX("+ - windowWidth +"px)";
					imageLi[idx].style.transform = "translateX(0px)";
					imageLi[next].style.transform = "translateX(" + windowWidth + "px)";
				}
				clearInterval(timer);
				timer = setInterval(function(){
					showNext();
				},3000)
			}
			function showNext(){
				prev = idx;
				idx = next;
				next++;
				if(next > imageLi.length-1){
					next = 0;
				}
				imageLi[next].style.transition = "none";
				imageLi[next].style.transform = "translateX("+ windowWidth +"px)";

				imageLi[prev].style.transition="all 0.3s ease 0s";
				imageLi[idx].style.transition="all 0.3s ease 0s";

				imageLi[prev].style.transform = "translateX("+ - windowWidth+"px)";
				imageLi[idx].style.transform = "translateX(0px)";
				$circleLi.each(function(i){
					$(this).css("background-color","#fff")
				});
				$circleLi.eq(idx).css("background-color","#d43e2e");

			}
			// var windowWidth;
			// //初始化图片的位置
			// init();
			// //当屏幕的尺寸改变的时候也要初始化
			// window.onresize = init;
			// function init(){
			// 	windowWidth = document.documentElement.clientWidth;
			// 	$carousel.css("height",windowWidth/(414/215));
			//
			// }
		</script>
		<!--倒计时-->
		<script type="text/javascript">
			function addtimer(endTime,startTime = new Date()){
				// console.log(endTime);
				var distancetime = endTime - startTime;
				var ms = Math.floor(distancetime%1000);
				var sec = Math.floor(distancetime/1000%60);
				var min = Math.floor(distancetime/1000/60%60);
				var hour = Math.floor(distancetime/1000/60/60%24);
				var day = Math.floor(distancetime/1000/60/60/24);
				return {
					day1:parseInt(day/10),
					day2:parseInt(day%10),
					hour1: parseInt(hour/10),
					hour2: parseInt(hour%10),
					min1: parseInt(min/10),
					min2: parseInt(min%10),
					sec1: parseInt(sec/10),
					sec2: parseInt(sec%10),
					ms1: parseInt(ms/100),
					ms2: parseInt((ms-parseInt(ms/100)*100)/10)
				}
			}
			 var span = document.querySelectorAll(".detail-wrap");
			 setInterval(()=>{
				 var time = addtimer(new Date(2017,10,11));
					 span[0].innerHTML = time.day1;
					 span[1].innerHTML = time.day2;
					 span[2].innerHTML = time.hour1;
					 span[3].innerHTML = time.hour2;
					 span[4].innerHTML = time.min1;
					 span[5].innerHTML = time.min2;
					 span[6].innerHTML = time.sec1;
					 span[7].innerHTML = time.sec2;
					 span[8].innerHTML = time.ms1;
					 span[9].innerHTML = time.ms2;
			 },50);
		</script>
		<!--热门商品分类、吸顶、页面加载、跳转、回到顶部-->
		<script type="text/javascript">
			var oCatTop = document.querySelector("#cat-top");
			var oBackUp = document.querySelector("#back-top");
			var topDis = getAllTop(oCatTop);
			var page = 1;
				$myajax("http://h6.duchengjiu.top/shop/api_cat.php",".cat-template","#cat-top",2,function(obj){
					var oCatTopLi = document.querySelectorAll("#cat-top li div");
					var oGoodsUl = document.querySelectorAll(".goods>ul");
					var prev = 0;
					for(var i = 0;i < oCatTopLi.length;i++){
						oCatTopLi[i].index = i;
						oCatTopLi[i].addEventListener("touchend",function(){
								oCatTopLi[prev].className = "";
								oGoodsUl[prev].style.display = "none";
								this.className = "goods-now";
								prev = this.index;
								console.log(oGoodsUl[prev]);
								 oGoodsUl[prev].style.display = "block";
						},false);
					}
				});
				$myajax("http://h6.duchengjiu.top/shop/api_goods.php",".hot-goods-template",".hot-goods",10,function(){return 0;});
				$myajax("http://h6.duchengjiu.top/shop/api_goods.php?cat_id=45",".hot-goods-template",".goods-apart0",10,function(){return 0;});
				$myajax("http://h6.duchengjiu.top/shop/api_goods.php?cat_id=55",".hot-goods-template",".goods-apart1",10,function(){return 0;});


			function $myajax(url,template,objectclass,num,callback){
				$.ajax({
						url:url,
						type:"get",
						dataType:'json',
						success: function(json){
							var data = json.data;
							var oTemplate = document.querySelector(template).innerHTML;
							var object = document.querySelector(objectclass);
							for(var i = 0; i < num;i++){
								var obj = data[i];
								object.innerHTML += compile(oTemplate,obj);
							}
							// console.log(object);
							callback(object);
						}
					})

			}
				function compile(template,data){
					return template.replace(/\$\{([a-zA-Z_]+)\}/g, function(match, $1) {
			      return data[$1];
			    });
				}
				oBackUp.onclick = function(){
					scrollAnimate(0,1000);
				}
				window.onscroll = function(){
					var nowTop = document.documentElement.scrollTop || document.body.scrollTop;
					if(nowTop >= topDis){
						oCatTop.style.position = 'fixed';
						oCatTop.style.top = 0;
						oCatTop.style.zIndex = 2;
					}else{
						oCatTop.style.position ='relative';
						oCatTop.style.zIndex = '0';
					}
					if(nowTop > 10){
						oBackUp.style.display = 'block';
					}else{
						oBackUp.style.display = 'none';
					}
					if(nowTop > page*1000){
						page++;
						newpage(page,'http://h6.duchengjiu.top/shop/api_goods.php',".hot-goods-template",".hot-goods");
						newpage(page,"http://h6.duchengjiu.top/shop/api_goods.php?cat_id=45",".hot-goods-template",".goods-apart0");
						newpage(page,"http://h6.duchengjiu.top/shop/api_goods.php?cat_id=55",".hot-goods-template",".goods-apart1");
					}
				}

				function newpage(page,url,template,objectclass){
					if(page < 6){
						$.ajax({
							url:url,
							type:"get",
							dataType:'json',
							data:{page:page,
							     	pagesize:10},
							success:function(json){
								var data = json.data;
								var oTemplate = document.querySelector(template).innerHTML;
								var object = document.querySelector(objectclass);
								for(var i = 0; i < data.length;i++){
									var obj = data[i];
									object.innerHTML += compile(oTemplate,obj);
							}
						}
						})
					}else {
						return 0;
					}
				}
				function getAllTop(obj){
					var allTop = obj.offsetTop;
					while (obj = obj.offsetParent) {
						allTop += obj.offsetTop;
					}
					return allTop;
				}
				function scrollAnimate(target,timer){
					var interval = 20;
					var frame = 0;
					var frames = timer / interval;
					var start = document.body.scrollTop || document.documentElement.scrollTop;
					var distance = target - start;
					var timer;
					clearInterval(timer);
					timer = setInterval(function(){
						frame ++;
						if(frame >= frames){
							clearInterval(timer);
						}
						document.body.scrollTop = document.documentElement.scrollTop = CubicEaseInOut(frame,start,distance,frames);
					},interval);
				}
				function CubicEaseInOut(t,b,c,d){
					if ((t/=d/2) < 1) return c/2*t*t*t + b;
					return c/2*((t-=2)*t*t + 2) + b;
				}
				function goodsxx(){
					var oHotGoodsBox = document.querySelectorAll('.hot-goods-box');
					for(var i = 0 ; i < oHotGoodsBox.length;i++){
							$(oHotGoodsBox[i]).mouseenter(function(){
								$(this).children(".hot-goods-layer").animate({"top":255});
							});
							$(oHotGoodsBox[i]).mouseleave(function(){
								$(this).children(".hot-goods-layer").animate({"top":370});
							});
					}
				}

		</script>
		<!--回到顶部-->
	</body>
</html>
